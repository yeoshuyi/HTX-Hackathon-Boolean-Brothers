<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Firefighter Situation Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }

    .map-container {
      position: relative;
      width: 100%;
      height: 100vh;
      background: #1a1a1a;
      overflow: hidden;
    }

    #floorplan, #heatmapCanvas, #annotationCanvas, #rulerCanvas {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      object-fit: contain;
      image-rendering: pixelated;
      display: block;
    }

    #heatmapCanvas { z-index: 3; pointer-events: none; display: none; }
    #annotationCanvas { z-index: 5; cursor: crosshair; display: none; pointer-events: auto; }
    #rulerCanvas { z-index: 25; pointer-events: auto; display: none; }

    .firefighter-marker {
      position: absolute;
      width: 40px; height: 40px;
      transform: translate(-50%, -50%);
      display: flex; 
      align-items: center; 
      justify-content: center;
      pointer-events: auto;
      z-index: 11;
      cursor: grab;
      user-select: none;
    }
    .firefighter-marker:active { cursor: grabbing; }
    
    .firefighter-badge {
      width: 40px; 
      height: 40px; 
      border-radius: 3px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-size: 16px;
      font-weight: 600;
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.2);
      transition: transform 0.1s;
    }
    .firefighter-marker:hover .firefighter-badge { 
      transform: scale(1.1); 
    }
    
    .firefighter-popup {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 8px;
      background: #2a2a2a;
      border: 1px solid #3f3f3f;
      border-radius: 2px;
      padding: 8px 12px;
      min-width: 140px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      z-index: 100;
      pointer-events: none;
    }
    
    .firefighter-popup::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-bottom-color: #3f3f3f;
    }
    
    .firefighter-popup-name {
      font-size: 11px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }
    
    .firefighter-popup-o2 {
      font-size: 10px;
      color: #aaa;
    }

    .o2-bar { height: 4px; border-radius: 0; transition: width 0.3s, background 0.3s; }
    .o2-bar.high { background: #4ade80; }
    .o2-bar.medium { background: #facc15; }
    .o2-bar.low { background: #f87171; }
    .o2-bar.critical { background: #dc2626; animation: pulse 1s infinite; }

    #locationsLayer { z-index: 10; pointer-events: none; }

    .icon-marker {
      position: absolute;
      transform: translate(-50%, -50%);
      width: 36px; height: 36px;
      z-index: 20; cursor: grab; user-select: none; pointer-events: auto;
      display: grid; place-items: center;
      filter: drop-shadow(0 1px 3px rgba(0,0,0,0.7));
    }
    .icon-marker:active { cursor: grabbing; }
    .icon-emoji { font-size: 28px; line-height: 1; user-select: none; }
    .icon-svg { width: 28px; height: 28px; display: block; user-select: none; }

    .ruler-marker {
      position: absolute;
      transform: translate(-50%, -50%);
      width: 14px; height: 14px;
      background: #0d7bdb;
      border: 2px solid #fff;
      border-radius: 50%;
      z-index: 26; cursor: grab; user-select: none; pointer-events: auto;
      box-shadow: 0 2px 4px rgba(0,0,0,0.7);
    }
    .ruler-marker:active { cursor: grabbing; }
    .ruler-marker:hover { background: #0c6ec7; transform: translate(-50%, -50%) scale(1.15); }

    .reference-scale {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 30;
      background: #2a2a2a;
      border: 1px solid #3f3f3f;
      border-radius: 2px;
      padding: 8px 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
      pointer-events: none;
    }
    
    .reference-scale-line {
      width: 100px;
      height: 2px;
      background: #0d7bdb;
      position: relative;
      margin-bottom: 4px;
    }
    
    .reference-scale-tick {
      position: absolute;
      width: 2px;
      height: 8px;
      background: #0d7bdb;
      top: -3px;
    }
    
    .reference-scale-label {
      font-size: 11px;
      color: #fff;
      text-align: center;
      font-weight: 500;
    }

    .dyn-marker { 
      position:absolute; transform:translate(-50%,-50%); width:34px; height:34px;
      z-index:22; cursor:grab; display:grid; place-items:center; pointer-events:auto;
      filter: drop-shadow(0 1px 3px rgba(0,0,0,0.7)); 
    }
    .dyn-marker:active { cursor: grabbing; }

    .toggle-btn.active { background: #0d7bdb; color: white; border-color: #0a5fa8; }
    .invalid { box-shadow: 0 0 0 2px #ef4444; }

    #leftToolbar {
      position: absolute;
      left: 12px; top: 12px;
      z-index: 30;
      background: #2a2a2a;
      border: 1px solid #3f3f3f;
      border-radius: 2px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    
    .tool-icon-btn {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      background: #383838;
      border: 1px solid #4a4a4a;
      border-radius: 2px;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.1s;
    }
    .tool-icon-btn:hover {
      background: #404040;
      border-color: #555;
    }
    .tool-icon-btn.active {
      background: #0d7bdb;
      border-color: #0a5fa8;
    }
    
    .tool-divider {
      height: 1px;
      background: #3f3f3f;
      margin: 2px 0;
    }

    #colorPalette {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 3px;
      padding-top: 4px;
      border-top: 1px solid #3f3f3f;
    }
    
    .color-chip {
      width: 16px; height: 16px; 
      border-radius: 1px;
      border: 1px solid #555;
      cursor: pointer;
      transition: all 0.1s;
    }
    .color-chip:hover {
      border-color: #888;
    }
    .color-chip.selected { 
      box-shadow: 0 0 0 2px #0d7bdb;
      border-color: #0d7bdb;
    }
  </style>
</head>

<body class="bg-[#1e1e1e] text-gray-200">
<div class="flex h-screen">
  <div class="w-80 bg-[#252525] border-r border-[#3a3a3a] flex flex-col">
    <div class="p-3 bg-[#c53030] border-b border-[#a02626]">
      <h1 class="text-base font-semibold tracking-tight">Firefighter Status</h1>
      <p class="text-xs text-red-100 mt-0.5">Live Monitoring</p>
    </div>
    
    <div id="firefighterList" class="divide-y divide-[#333] flex-shrink-0"></div>
    
    <div class="flex-1 border-t border-[#3a3a3a] p-3 space-y-2">
      <div class="text-xs font-semibold text-gray-400 mb-3">CONTROLS</div>
      
      <button id="toggleLocations" class="toggle-btn w-full px-3 py-2 bg-[#383838] border border-[#4a4a4a] rounded text-xs font-medium hover:bg-[#404040] active text-left">
        üìç Locations
      </button>
      
      <button id="toggleHeatMap" class="toggle-btn w-full px-3 py-2 bg-[#383838] border border-[#4a4a4a] rounded text-xs font-medium hover:bg-[#404040] text-left">
        üî• Heat Map
      </button>
      
      <button id="toggleAnnotations" class="toggle-btn w-full px-3 py-2 bg-[#383838] border border-[#4a4a4a] rounded text-xs font-medium hover:bg-[#404040] text-left">
        ‚úèÔ∏è Annotations
      </button>
      
      <button id="toggleRuler" class="toggle-btn w-full px-3 py-2 bg-[#383838] border border-[#4a4a4a] rounded text-xs font-medium hover:bg-[#404040] text-left">
        üìè Ruler
      </button>
      
      <div class="pt-2 border-t border-[#3a3a3a] mt-3 space-y-2">
        <button id="generateBtn" class="w-full px-3 py-2 bg-[#0d7bdb] hover:bg-[#0c6ec7] border border-[#0a5fa8] rounded text-white text-xs font-medium">
          üß© Generate Path Map
        </button>
        
        <button id="clearBtn" class="w-full px-3 py-2 bg-[#383838] border border-[#4a4a4a] rounded text-xs font-medium hover:bg-[#404040]">
          üßπ Clear
        </button>
        
        <button id="analysisBtn" class="w-full px-3 py-2 bg-[#7c3aed] hover:bg-[#6d28d9] border border-[#5b21b6] rounded text-white text-xs font-medium">
          üìä View Analysis
        </button>
        
        <button id="uploadFloorplanBtn" class="w-full px-3 py-2 bg-[#383838] border border-[#4a4a4a] rounded text-xs font-medium hover:bg-[#404040]">
          üì§ Upload Floorplan
        </button>
        
        <button id="blankFloorplanBtn" class="w-full px-3 py-2 bg-[#383838] border border-[#4a4a4a] rounded text-xs font-medium hover:bg-[#404040]">
          üìÑ Blank Floorplan
        </button>
        
        <input type="file" id="floorplanFileInput" accept="image/*" style="display: none;" />
      </div>
    </div>
    
    <div class="bg-[#2a2a2a] border-t border-[#3a3a3a] p-2.5 space-y-1.5 text-xs">
      <div class="text-gray-300">üö® Active: Structure Fire</div>
      <div class="text-gray-300">üë• Personnel: <span id="personnelCount">3</span></div>
      <div class="text-gray-300">‚è±Ô∏è <span id="incidentTime">00:00:00</span></div>
      <div class="text-yellow-400 font-medium pt-1 border-t border-[#3a3a3a]">‚ö†Ô∏è High Temp Zone</div>
    </div>
  </div>

  <div class="flex-1 relative">
    <div class="map-container">
      <img id="floorplan" src="/static/floorplan1.png" alt="Floorplan" />
      <canvas id="heatmapCanvas"></canvas>
      <canvas id="annotationCanvas"></canvas>
      <canvas id="rulerCanvas"></canvas>
      <div id="locationsLayer" class="absolute inset-0"></div>

      <div id="startMarker" class="icon-marker" style="left: 60px; top: 60px;">
        <span class="icon-emoji" title="Start">üö©</span>
      </div>
      <div id="endMarker" class="icon-marker" style="left: 160px; top: 60px;">
        <span class="icon-emoji" title="End">üèÅ</span>
      </div>

      <div class="reference-scale">
        <div class="reference-scale-line">
          <div class="reference-scale-tick" style="left: 0;"></div>
          <div class="reference-scale-tick" style="right: 0;"></div>
        </div>
        <div class="reference-scale-label">1 meter</div>
      </div>

      <div id="leftToolbar" style="display: none;">
        <button id="pencilBtn" class="tool-icon-btn active" title="Pencil">‚úèÔ∏è</button>
        <button id="eraserBtn" class="tool-icon-btn" title="Eraser">üßΩ</button>
        
        <div class="tool-divider"></div>
        
        <button id="addFireBtn" class="tool-icon-btn" title="Add Fire">üî•</button>
        <button id="addCasualtyBtn" class="tool-icon-btn" title="Add casualty">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <rect x="2" y="2" width="20" height="20" rx="3" fill="#dc2626"/>
            <rect x="10.25" y="5" width="3.5" height="14" fill="white"/>
            <rect x="5" y="10.25" width="14" height="3.5" fill="white"/>
          </svg>
        </button>
        
        <div id="colorPalette">
          <div class="color-chip selected" data-color="#000000" style="background:#000000"></div>
          <div class="color-chip" data-color="#ffffff" style="background:#ffffff"></div>
          <div class="color-chip" data-color="#ef4444" style="background:#ef4444"></div>
          <div class="color-chip" data-color="#f97316" style="background:#f97316"></div>
          <div class="color-chip" data-color="#facc15" style="background:#facc15"></div>
          <div class="color-chip" data-color="#22c55e" style="background:#22c55e"></div>
          <div class="color-chip" data-color="#60a5fa" style="background:#60a5fa"></div>
          <div class="color-chip" data-color="#a78bfa" style="background:#a78bfa"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="module" src="/static/main.js"></script>
</body>
</html>
