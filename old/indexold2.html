<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firefighter Situation Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; overflow: hidden; font-family: system-ui, -apple-system, sans-serif; }
    .map-container { position: relative; width: 100%; height: 100%; background: #1a1a1a; }
    .map-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    .map-layer.active { pointer-events: auto; }
    .firefighter-marker {
      position: absolute; width: 32px; height: 32px;
      border: 3px solid #fff; border-radius: 50%;
      transform: translate(-50%, -50%);
      display: flex; align-items: center; justify-content: center;
      color: white; font-weight: bold; font-size: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: all 0.3s;
    }
    .firefighter-marker:hover { transform: translate(-50%, -50%) scale(1.2); }
    .o2-bar { height: 8px; border-radius: 4px; transition: width 0.3s, background 0.3s; }
    .o2-bar.high { background: #22c55e; }
    .o2-bar.medium { background: #eab308; }
    .o2-bar.low { background: #ef4444; }
    .o2-bar.critical { background: #dc2626; animation: pulse 1s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .heat-gradient {
      background: radial-gradient(circle at 30% 40%, rgba(255, 0, 0, 0.6) 0%, transparent 40%),
                  radial-gradient(circle at 70% 60%, rgba(255, 100, 0, 0.5) 0%, transparent 35%),
                  radial-gradient(circle at 50% 80%, rgba(255, 150, 0, 0.4) 0%, transparent 30%);
    }
    #annotationCanvas { cursor: crosshair; }
    .toggle-btn { transition: all 0.2s; }
    .toggle-btn.active { background: #3b82f6; color: white; }
  </style>
</head>
<body class="bg-gray-900 text-white">

  <div class="flex h-screen">
    <!-- Sidebar -->
    <div class="w-80 bg-gray-800 border-r border-gray-700 overflow-y-auto">
      <div class="p-4 bg-red-600 border-b border-red-700">
        <h1 class="text-xl font-bold">Firefighter Status</h1>
        <p class="text-sm text-red-100">Live Monitoring</p>
      </div>
      <div id="firefighterList" class="divide-y divide-gray-700"></div>
    </div>

    <!-- Main Area -->
    <div class="flex-1 flex flex-col">
      <div class="bg-gray-800 border-b border-gray-700 p-4 flex items-center justify-between">
        <div class="flex gap-2">
          <button id="toggleLocations" class="toggle-btn px-4 py-2 bg-gray-700 rounded hover:bg-gray-600 active">üìç Locations</button>
          <button id="toggleHeatMap" class="toggle-btn px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">üî• Heat Map</button>
          <button id="toggleAnnotations" class="toggle-btn px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">‚úèÔ∏è Annotations</button>
        </div>
        <div class="flex gap-2">
          <button id="clearAnnotations" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">üóëÔ∏è Clear Drawings</button>
          <select id="drawColor" class="px-3 py-2 bg-gray-700 rounded">
            <option value="#ef4444">Red</option>
            <option value="#3b82f6">Blue</option>
            <option value="#22c55e">Green</option>
            <option value="#eab308">Yellow</option>
            <option value="#ffffff">White</option>
          </select>
        </div>
      </div>

      <!-- Map Container -->
      <div class="flex-1 relative">
        <div class="map-container">
          <!-- Dynamic floorplan -->
          <div id="floorplanLayer" class="map-layer"
               style="background: #1a1a1a; background-size: contain; background-position: center; background-repeat: no-repeat;">
          </div>

          <!-- Heat map layer -->
          <div id="heatMapLayer" class="map-layer heat-gradient" style="display: none;"></div>

          <!-- Firefighter markers -->
          <div id="locationsLayer" class="map-layer"></div>

          <!-- Annotation canvas -->
          <canvas id="annotationCanvas" class="map-layer" style="display: none;"></canvas>
        </div>
      </div>

      <!-- Footer -->
      <div class="bg-gray-800 border-t border-gray-700 p-3 flex items-center justify-between text-sm">
        <div class="flex gap-6">
          <span>üö® Active Incident: Structure Fire</span>
          <span>üë• Personnel: <span id="personnelCount">3</span> Active</span>
          <span>‚è±Ô∏è Duration: <span id="incidentTime">00:00:00</span></span>
        </div>
        <div class="text-yellow-400 font-semibold">‚ö†Ô∏è High Temperature Zone Detected</div>
      </div>
    </div>
  </div>

  <script>
    // üî• FLOORPLAN SWITCHING
    const floorplan = new Image();
    floorplan.onload = () => {
      document.getElementById('floorplanLayer').style.backgroundImage = "url('floorplan2.png')";
    };
    floorplan.onerror = () => {
      document.getElementById('floorplanLayer').style.backgroundImage = "url('floorplan1.png')";
    };
    floorplan.src = 'floorplan2.png';

    // üßë‚Äçüöí Firefighter data
    const firefighters = [
      { id: 1, name: 'Cpt. DARREN', o2: 85, x: 27, y: 27 },
      { id: 2, name: 'Pvt. JUDITH', o2: 45, x: 67, y: 27 },
      { id: 3, name: 'Pvt. BERNICE', o2: 28, x: 27, y: 73 }
    ];

    function getO2Color(o2) {
      if (o2 < 30) return '#dc2626';
      if (o2 < 50) return '#ef4444';
      if (o2 < 75) return '#eab308';
      return '#22c55e';
    }

    function initFirefighterList() {
      const list = document.getElementById('firefighterList');
      list.innerHTML = '';
      firefighters.forEach(ff => {
        const card = document.createElement('div');
        const level = ff.o2 < 30 ? 'critical' : ff.o2 < 50 ? 'low' : ff.o2 < 75 ? 'medium' : 'high';
        card.className = 'p-4 hover:bg-gray-750';
        card.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-red-500 to-orange-600 flex items-center justify-center text-xl font-bold">${ff.id}</div>
            <div class="flex-1">
              <div class="font-semibold">${ff.name}</div>
              <div class="text-sm text-gray-400 mt-1">O‚ÇÇ Level: ${ff.o2}%</div>
              <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                <div class="o2-bar ${level}" style="width:${ff.o2}%"></div>
              </div>
            </div>
          </div>`;
        list.appendChild(card);
      });
    }

    function initFirefighterMarkers() {
      const layer = document.getElementById('locationsLayer');
      layer.innerHTML = '';
      firefighters.forEach(ff => {
        const marker = document.createElement('div');
        marker.className = 'firefighter-marker';
        marker.style.left = `${ff.x}%`;
        marker.style.top = `${ff.y}%`;
        marker.style.background = getO2Color(ff.o2);
        marker.textContent = ff.id;
        marker.title = `${ff.name} - O‚ÇÇ: ${ff.o2}%`;
        layer.appendChild(marker);
      });
    }

    // üß≠ Layer toggles
    const toggleHeatMap = document.getElementById('toggleHeatMap');
    const toggleLocations = document.getElementById('toggleLocations');
    const toggleAnnotations = document.getElementById('toggleAnnotations');
    const heatMapLayer = document.getElementById('heatMapLayer');
    const locationsLayer = document.getElementById('locationsLayer');
    const annotationCanvas = document.getElementById('annotationCanvas');

    toggleHeatMap.onclick = () => {
      toggleHeatMap.classList.toggle('active');
      heatMapLayer.style.display = toggleHeatMap.classList.contains('active') ? 'block' : 'none';
    };

    toggleLocations.onclick = () => {
      toggleLocations.classList.toggle('active');
      locationsLayer.style.display = toggleLocations.classList.contains('active') ? 'block' : 'none';
    };

    toggleAnnotations.onclick = () => {
      const on = toggleAnnotations.classList.toggle('active');
      annotationCanvas.style.display = on ? 'block' : 'none';
      annotationCanvas.classList.toggle('active', on);
      if (on) resizeCanvas();
    };

    // ‚úèÔ∏è Drawing system
    const ctx = annotationCanvas.getContext('2d');
    let drawing = false, lastX = 0, lastY = 0;

    function resizeCanvas() {
      annotationCanvas.width = annotationCanvas.offsetWidth;
      annotationCanvas.height = annotationCanvas.offsetHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    annotationCanvas.addEventListener('mousedown', e => {
      if (!toggleAnnotations.classList.contains('active')) return;
      drawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    annotationCanvas.addEventListener('mousemove', e => {
      if (!drawing) return;
      ctx.strokeStyle = document.getElementById('drawColor').value;
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    annotationCanvas.addEventListener('mouseup', () => drawing = false);
    annotationCanvas.addEventListener('mouseout', () => drawing = false);
    document.getElementById('clearAnnotations').onclick = () => ctx.clearRect(0, 0, annotationCanvas.width, annotationCanvas.height);

    // ‚è±Ô∏è Incident timer
    let seconds = 0;
    setInterval(() => {
      seconds++;
      const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
      const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      const s = String(seconds % 60).padStart(2, '0');
      document.getElementById('incidentTime').textContent = `${h}:${m}:${s}`;
    }, 1000);

    // Initialize
    initFirefighterList();
    initFirefighterMarkers();
    document.getElementById('personnelCount').textContent = firefighters.length;
  </script>

</body>
</html>
